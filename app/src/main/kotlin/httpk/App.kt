/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package httpk

import httpk.server.Server
import java.nio.file.Paths
import java.time.Instant
import java.time.ZoneId
import java.time.format.DateTimeFormatter

fun log(message: String) {
    val dateTimeFormatter = DateTimeFormatter
        .ofPattern("uuuu-MM-dd HH:mm:ss.SSS")
        .withZone(ZoneId.of("Asia/Tokyo"))
    val timestamp = dateTimeFormatter.format(Instant.now())
    println("[${timestamp}] [${Thread.currentThread().name}] $message")
}


fun main() {
    Runtime.getRuntime().addShutdownHook(Thread { log("server terminated.") })

    val server = Server(
        documentRoot = Paths.get("../sample").toAbsolutePath().normalize(),
        port = 8080
    )

    server.listen()
}
